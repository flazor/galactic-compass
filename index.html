<html>
  <head>
    <link rel="stylesheet" href="main.css">
    <script src="lib/aframe.min.js"></script>
    <script src="lib/suncalc.js"></script>
    <script src="script.js" type="module" defer></script>
  </head>

  <body onload="loadBG();">
    <script>
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('sw.js');
      }
    </script>
    <button id="reloadButton" style="position: fixed; top: 10px; left: 10px;">&#x21bb;</button>
    <button id="hiResButton" style="position: fixed; top: 10px; right: 10px;">
      Hi-Res
    </button>
    <div id="debugOutput" style="position: fixed; bottom: 10px; left: 10px; background: rgba(0,0,0,0.8); color: #00FF00; padding: 10px; border-radius: 8px; font-size: 12px; width: 90vw; max-height: 18px; overflow-y: auto; z-index: 9999; font-family: monospace; cursor: pointer; transition: max-height 0.3s ease;" onclick="toggleDebugExpansion()">
      Debug info will appear here... (click to expand)
    </div>
    <a-scene vr-mode-ui="enabled: false" button>
      <a-entity light="type: ambient; color: #BBB"></a-entity>
      <a-camera id="camera" look-controls="touchEnabled: false" position="0 0 0"></a-camera>
      <a-sky id="a-sky" src="https://s3.eu-west-1.amazonaws.com/rideyourbike.org/compass/starmap_2020_1k_gal.jpg"></a-sky>
      <a-circle id="earth-surface" position="0 -0.1 0" rotation="-90 0 0" radius="900" color="blue" material="transparent: true; opacity: 0.1; side: double; depthWrite: false;"></a-circle>

      <a-entity id="milky-way-container">
        <a-sphere id="black-hole-sphere" color="#DD33DD" position="-490 0 0" radius="3"></a-sphere>
      </a-entity>
      <a-entity id="moon-container">
        <a-sphere id="moon-sphere" color="#DDDDDD" position="-490 0 0" radius="13"></a-sphere>
      </a-entity>
      <a-entity id="sun-container">
        <a-entity position="-245 0 0" light="type:directional; castShadow:true;"></a-entity>
        <a-sphere id="sun-sphere" color="#FFFFDD" position="-245 0 0" radius="7"></a-sphere>
      </a-entity>
      <a-entity id="compass-container">
        <a-text id="east" value="E" color="#FF0000" position="0 0 -490" scale="100 100 100" rotation="0 0 0"></a-text>
        <a-text id="west" value="W" color="#FF0000" position="0 0 490" scale="100 100 100" rotation="0 180 0"></a-text>
        <a-text id="south" value="S" color="#FF0000" position="490 0 0" scale="100 100 100" rotation="0 -90 0"></a-text>
        <a-text id="north" value="N" color="#FF0000" position="-490 0 0" scale="100 100 100" rotation="0 90 0"></a-text>
      </a-entity>
      
      <a-entity id="earth-rotation-container" look-at="[camera]">
        <a-sphere id="earth-rotation-direction-sphere" position="-2 0 0" color="#00FF00" radius="0.01"></a-sphere>
        <a-circle id="earth-rotation-hud-plane" position="-2.1 0 0" rotation="0 90 0" color="#00FF00" radius="0.5" material="transparent: true; opacity: 0.2; side: double;"></a-circle>
        <a-text id="earth-rotation-hud-text" position="-2 0 0" rotation="0 90 0" value="+" color="#00FF00"></a-text>
      </a-entity>
      <a-entity id="earth-orbit-container" look-at="[camera]">
        <a-sphere id="earth-orbit-direction-sphere" position="-2 0 0" color="#0000FF" radius="0.01"></a-sphere>
        <a-circle id="earth-orbit-hud-plane" position="-2.1 0 0" rotation="0 90 0" color="#0000FF" radius="0.5" material="transparent: true; opacity: 0.2; side: double; depthWrite: false;"></a-circle>
        <a-text id="earth-orbit-hud-text" position="-2 0 0" rotation="0 90 0" value="+" color="#0000FF"></a-text>
      </a-entity>
      <a-entity id="solar-orbit-container" look-at="[camera]">
        <a-sphere id="solar-orbit-direction-sphere" position="-2 0 0" color="#FFFF00" radius="0.01"></a-sphere>
        <a-circle id="solar-orbit-hud-plane" position="-2.1 0 0" rotation="0 90 0" color="#FFFF00" radius="0.5" material="transparent: true; opacity: 0.2; side: double; depthWrite: false;"></a-circle>
        <a-text id="solar-orbit-hud-text" position="-2 0 0" rotation="0 90 0" value="+" color="#FFFF00"></a-text>
      </a-entity>
      <a-entity id="andromeda-pull-container" look-at="[camera]">
        <a-sphere id="andromeda-pull-direction-sphere" position="-2 0 0" color="#FF0000" radius="0.01"></a-sphere>
        <a-circle id="andromeda-pull-hud-plane" position="-2.1 0 0" rotation="0 90 0" color="#FF0000" radius="0.5" material="transparent: true; opacity: 0.2; side: double; depthWrite: false;"></a-circle>
        <a-text id="andromeda-pull-hud-text" position="-2 0 0" rotation="0 90 0" value="+" color="#FF0000"></a-text>
      </a-entity>
      <a-entity id="great-attractor-container" look-at="[camera]">
        <a-sphere id="great-attractor-sphere" position="-2 0 0" color="#FF00FF" radius="0.01"></a-sphere>
        <a-circle id="great-attractor-hud-plane" position="-2.1 0 0" rotation="0 90 0" color="#FF00FF" radius="0.5" material="transparent: true; opacity: 0.2; side: double; depthWrite: false;"></a-circle>
        <a-text id="great-attractor-hud-text" position="-2 0 0" rotation="0 90 0" value="+" color="#FF00FF"></a-text>
      </a-entity>

    </a-scene>


<script>
// Register Service Worker for offline functionality
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('./sw.js', { scope: './' })
      .then((registration) => {
        console.log('Service Worker registered successfully:', registration.scope);
        
        // Optional: Listen for updates
        registration.addEventListener('updatefound', () => {
          const newWorker = registration.installing;
          newWorker.addEventListener('statechange', () => {
            if (newWorker.state === 'activated') {
              console.log('New Service Worker activated');
              // Optionally reload the page or show a notification
              // window.location.reload();
            }
          });
        });
      })
      .catch((error) => {
        console.log('Service Worker registration failed:', error);
      });
  });
} else {
  console.log('Service Workers are not supported by this browser');
}
</script>

  </body>
</html>
