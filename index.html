<html>
  <head>
    <link rel="stylesheet" href="main.css">
    <script src="lib/aframe.min.js"></script>
    <script src="lib/suncalc.js"></script>
    <script src="script.js" type="module" defer></script>
  </head>

  <body>
    <button id="reloadButton" style="position: fixed; top: 10px; left: 10px;">&#x21bb;</button>
    <button id="hiResButton" style="position: fixed; top: 10px; right: 60px;">
      Hi-Res
    </button>
    
    <!-- Cosmic Level Controls -->
    <button id="levelControlsToggle" style="position: fixed; top: 10px; right: 10px; color: #00FF00; border-color: white;" title="Cosmic Motion Levels">
      ⚙️
    </button>
    
    <div id="levelControlsPanel" style="position: fixed; top: 60px; left: 10px; right: 10px; background: rgba(0,0,0,0.5); border: 1px solid #00FF00; border-radius: 8px; padding: 15px; color: #00FF00; font-family: monospace; font-size: 12px; z-index: 10000; display: none;">
      <div style="margin-bottom: 15px; font-size: 14px; text-align: center; border-bottom: 1px solid #00FF00; padding-bottom: 8px;">
        Cosmic Motion Levels
      </div>

      <div id="vizModeSelector" style="margin-bottom: 15px; display: flex; gap: 8px; justify-content: center;">
        <label style="cursor: pointer;"><input type="checkbox" name="vizMode" value="markers" checked> Markers</label>
        <label style="cursor: pointer;"><input type="checkbox" name="vizMode" value="distance" checked> Distance</label>
        <label style="cursor: pointer;"><input type="checkbox" name="vizMode" value="particles" checked> Particles</label>
      </div>

      <div style="margin-bottom: 10px;">
        <span id="levelDisplayText">Showing up to Level 8</span>
      </div>
      
      <div style="margin-bottom: 15px;">
        <input type="range" id="levelSlider" min="1" max="8" value="8" 
               style="width: 100%; height: 20px; background: #003300; border-radius: 10px;">
      </div>
      
      <div id="levelDescription" style="margin-bottom: 15px; min-height: 60px; padding: 8px; background: rgba(0,255,0,0.1); border-radius: 4px; font-size: 11px;">
        <strong>CMB Dipole</strong><br>
        Net motion relative to Cosmic Microwave Background<br>
        ~370 km/s toward Leo/Crater
      </div>
      
      <div id="vectorSumDisplay" style="margin-bottom: 15px; padding: 8px; background: rgba(255,255,0,0.1); border-radius: 4px; font-size: 10px; border: 1px solid #FFFF00;">
        <div style="font-weight: bold; margin-bottom: 5px; color: #FFFF00;">Your Velocity:</div>
        <div id="vectorSumText">Calculating...</div>
      </div>
      
      <div style="font-size: 10px; opacity: 0.7;">
        <div id="levelStats">6 of 8 levels • 5 implemented</div>
      </div>
    </div>
    <div id="debugOutput" style="position: fixed; bottom: 10px; left: 10px; background: rgba(0,0,0,0.5); color: #00FF00; padding: 10px; border-radius: 8px; font-size: 12px; width: 90vw; max-height: 18px; overflow-y: auto; z-index: 9999; font-family: monospace; cursor: pointer; transition: max-height 0.3s ease;" onclick="toggleDebugExpansion()">
      Debug info will appear here... (click to expand)
    </div>
    <a-scene vr-mode-ui="enabled: false">
      <a-entity light="type: ambient; color: #BBB"></a-entity>
      <a-camera id="camera" look-controls="touchEnabled: false" position="0 0 0"></a-camera>
      <a-sky id="a-sky" src="https://s3.eu-west-1.amazonaws.com/rideyourbike.org/compass/starmap_2020_1k_gal.jpg"></a-sky>
      <a-circle id="earth-surface" position="0 -0.1 0" rotation="-90 0 0" radius="900" color="blue" material="transparent: true; opacity: 0.1; side: double; depthWrite: false;"></a-circle>

      <a-entity id="milky-way-container">
        <a-sphere id="black-hole-sphere" color="#DD33DD" position="-490 0 0" radius="3"></a-sphere>
      </a-entity>
      <a-entity id="moon-container">
        <a-sphere id="moon-sphere" color="#DDDDDD" position="-490 0 0" radius="13"></a-sphere>
      </a-entity>
      <a-entity id="sun-container">
        <a-entity position="-245 0 0" light="type:directional; castShadow:true;"></a-entity>
        <a-sphere id="sun-sphere" color="#FFFFDD" position="-245 0 0" radius="7"></a-sphere>
      </a-entity>
      <a-entity id="compass-container">
        <a-text id="east" value="E" color="#FF0000" position="0 0 -490" scale="100 100 100" rotation="0 0 0"></a-text>
        <a-text id="west" value="W" color="#FF0000" position="0 0 490" scale="100 100 100" rotation="0 180 0"></a-text>
        <a-text id="south" value="S" color="#FF0000" position="490 0 0" scale="100 100 100" rotation="0 -90 0"></a-text>
        <a-text id="north" value="N" color="#FF0000" position="-490 0 0" scale="100 100 100" rotation="0 90 0"></a-text>
      </a-entity>
      
      <a-entity id="earth-rotation-container" look-at="[camera]">
        <a-circle id="earth-rotation-hud-circle" position="-2 0 0" rotation="0 90 0" radius="0.1"
          color="#00FF00" material="transparent: true; opacity: 0.2; side: double"></a-circle>
        <a-text id="earth-rotation-hud-text" position="-2 -0.18 0" rotation="0 90 0"
          value="" color="#00FF00" align="center" width="1.5"></a-text>
      </a-entity>
      <a-entity id="earth-orbit-container" look-at="[camera]">
        <a-circle id="earth-orbit-hud-circle" position="-2 0 0" rotation="0 90 0" radius="0.1"
          color="#0000FF" material="transparent: true; opacity: 0.2; side: double; depthWrite: false"></a-circle>
        <a-text id="earth-orbit-hud-text" position="-2 -0.18 0" rotation="0 90 0"
          value="" color="#0000FF" align="center" width="1.5"></a-text>
      </a-entity>
      <a-entity id="solar-orbit-container" look-at="[camera]">
        <a-circle id="solar-orbit-hud-circle" position="-2 0 0" rotation="0 90 0" radius="0.1"
          color="#FFFF00" material="transparent: true; opacity: 0.2; side: double; depthWrite: false"></a-circle>
        <a-text id="solar-orbit-hud-text" position="-2 -0.18 0" rotation="0 90 0"
          value="" color="#FFFF00" align="center" width="1.5"></a-text>
      </a-entity>
      <a-entity id="local-group-motion-container" look-at="[camera]">
        <a-circle id="local-group-motion-hud-circle" position="-2 0 0" rotation="0 90 0" radius="0.1"
          color="#FF0000" material="transparent: true; opacity: 0.2; side: double; depthWrite: false"></a-circle>
        <a-text id="local-group-motion-hud-text" position="-2 -0.18 0" rotation="0 90 0"
          value="" color="#FF0000" align="center" width="1.5"></a-text>
      </a-entity>
      <a-entity id="local-void-push-container" look-at="[camera]">
        <a-circle id="local-void-push-hud-circle" position="-2 0 0" rotation="0 90 0" radius="0.1"
          color="#FF00FF" material="transparent: true; opacity: 0.2; side: double; depthWrite: false"></a-circle>
        <a-text id="local-void-push-hud-text" position="-2 -0.18 0" rotation="0 90 0"
          value="" color="#FF00FF" align="center" width="1.5"></a-text>
      </a-entity>
      <a-entity id="virgo-pull-container" look-at="[camera]">
        <a-circle id="virgo-pull-hud-circle" position="-2 0 0" rotation="0 90 0" radius="0.1"
          color="#00FFFF" material="transparent: true; opacity: 0.2; side: double; depthWrite: false"></a-circle>
        <a-text id="virgo-pull-hud-text" position="-2 -0.18 0" rotation="0 90 0"
          value="" color="#00FFFF" align="center" width="1.5"></a-text>
      </a-entity>
      <a-entity id="large-scale-flow-container" look-at="[camera]">
        <a-circle id="large-scale-flow-hud-circle" position="-2 0 0" rotation="0 90 0" radius="0.1"
          color="#FFA500" material="transparent: true; opacity: 0.2; side: double; depthWrite: false"></a-circle>
        <a-text id="large-scale-flow-hud-text" position="-2 -0.18 0" rotation="0 90 0"
          value="" color="#FFA500" align="center" width="1.5"></a-text>
      </a-entity>
      <a-entity id="cmb-dipole-motion-container" look-at="[camera]">
        <a-circle id="cmb-dipole-motion-hud-circle" position="-2 0 0" rotation="0 90 0" radius="0.1"
          color="#FFFFFF" material="transparent: true; opacity: 0.2; side: double; depthWrite: false"></a-circle>
        <a-text id="cmb-dipole-motion-hud-text" position="-2 -0.18 0" rotation="0 90 0"
          value="" color="#FFFFFF" align="center" width="1.5"></a-text>
      </a-entity>
      <a-entity id="resultant-1-container" look-at="[camera]">
        <a-circle id="resultant-1-hud-circle" position="-2 0 0" rotation="0 90 0" radius="0.1"
          color="#FFD700" material="transparent: true; opacity: 0.3; side: double; depthWrite: false"></a-circle>
        <a-text id="resultant-1-hud-text" position="-2 -0.18 0" rotation="0 90 0"
          value="" color="#FFD700" align="center" width="1.5"></a-text>
      </a-entity>
      <a-entity id="resultant-2-container" look-at="[camera]">
        <a-circle id="resultant-2-hud-circle" position="-2 0 0" rotation="0 90 0" radius="0.1"
          color="#FFD700" material="transparent: true; opacity: 0.3; side: double; depthWrite: false"></a-circle>
        <a-text id="resultant-2-hud-text" position="-2 -0.18 0" rotation="0 90 0"
          value="" color="#FFD700" align="center" width="1.5"></a-text>
      </a-entity>
      <a-entity id="resultant-3-container" look-at="[camera]">
        <a-circle id="resultant-3-hud-circle" position="-2 0 0" rotation="0 90 0" radius="0.1"
          color="#FFD700" material="transparent: true; opacity: 0.3; side: double; depthWrite: false"></a-circle>
        <a-text id="resultant-3-hud-text" position="-2 -0.18 0" rotation="0 90 0"
          value="" color="#FFD700" align="center" width="1.5"></a-text>
      </a-entity>
      <a-entity id="resultant-4-container" look-at="[camera]">
        <a-circle id="resultant-4-hud-circle" position="-2 0 0" rotation="0 90 0" radius="0.1"
          color="#FFD700" material="transparent: true; opacity: 0.3; side: double; depthWrite: false"></a-circle>
        <a-text id="resultant-4-hud-text" position="-2 -0.18 0" rotation="0 90 0"
          value="" color="#FFD700" align="center" width="1.5"></a-text>
      </a-entity>
      <a-entity id="resultant-5-container" look-at="[camera]">
        <a-circle id="resultant-5-hud-circle" position="-2 0 0" rotation="0 90 0" radius="0.1"
          color="#FFD700" material="transparent: true; opacity: 0.3; side: double; depthWrite: false"></a-circle>
        <a-text id="resultant-5-hud-text" position="-2 -0.18 0" rotation="0 90 0"
          value="" color="#FFD700" align="center" width="1.5"></a-text>
      </a-entity>
      <a-entity id="resultant-6-container" look-at="[camera]">
        <a-circle id="resultant-6-hud-circle" position="-2 0 0" rotation="0 90 0" radius="0.1"
          color="#FFD700" material="transparent: true; opacity: 0.3; side: double; depthWrite: false"></a-circle>
        <a-text id="resultant-6-hud-text" position="-2 -0.18 0" rotation="0 90 0"
          value="" color="#FFD700" align="center" width="1.5"></a-text>
      </a-entity>
      <a-entity id="resultant-7-container" look-at="[camera]">
        <a-circle id="resultant-7-hud-circle" position="-2 0 0" rotation="0 90 0" radius="0.1"
          color="#FFD700" material="transparent: true; opacity: 0.3; side: double; depthWrite: false"></a-circle>
        <a-text id="resultant-7-hud-text" position="-2 -0.18 0" rotation="0 90 0"
          value="" color="#FFD700" align="center" width="1.5"></a-text>
      </a-entity>
      <a-entity id="resultant-8-container" look-at="[camera]">
        <a-circle id="resultant-8-hud-circle" position="-2 0 0" rotation="0 90 0" radius="0.1"
          color="#FFD700" material="transparent: true; opacity: 0.3; side: double; depthWrite: false"></a-circle>
        <a-text id="resultant-8-hud-text" position="-2 -0.18 0" rotation="0 90 0"
          value="" color="#FFD700" align="center" width="1.5"></a-text>
      </a-entity>

    </a-scene>


<script>
// Register Service Worker for offline functionality
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('./sw.js', { scope: './' })
      .then((registration) => {
        console.log('Service Worker registered successfully:', registration.scope);
        
        // Optional: Listen for updates
        registration.addEventListener('updatefound', () => {
          const newWorker = registration.installing;
          newWorker.addEventListener('statechange', () => {
            if (newWorker.state === 'activated') {
              console.log('New Service Worker activated');
              // Optionally reload the page or show a notification
              // window.location.reload();
            }
          });
        });
      })
      .catch((error) => {
        console.log('Service Worker registration failed:', error);
      });
  });
} else {
  console.log('Service Workers are not supported by this browser');
}
</script>

  </body>
</html>
